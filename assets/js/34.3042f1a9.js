(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{557:function(n,s,t){"use strict";t.r(s);var a=t(5),e=Object(a.a)({},(function(){var n=this,s=n.$createElement,t=n._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"html2canvas-jspdf-实现-html-转-pdf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#html2canvas-jspdf-实现-html-转-pdf"}},[n._v("#")]),n._v(" "),t("a",{attrs:{href:"https://www.cnblogs.com/cmyoung/p/11609996.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("html2canvas + jspdf 实现 html 转 pdf"),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("在前端开发中， html 转 pdf 是最常见的需求，实现这块需求的开发 html2canvas 和 jspdf 是最常用的两个插件，插件都是现成的，但是有时候用不好，也不出现很多头疼问题：")]),n._v(" "),t("p",[n._v("\\1. 生成的 pdf 清晰度不高，比较模糊；")]),n._v(" "),t("p",[n._v("2.多页 pdf 会出现把内容给分割的情况，特别是文字被分割时，体验很不友好；")]),n._v(" "),t("p",[n._v("3.页面较宽或较长时，或出现生成的 pdf 内容不全的情况。")]),n._v(" "),t("p",[n._v("如果你在项目中出现以上情况，那么不着急，往下看就对了，下面的代码统统为你解决了")]),n._v(" "),t("p",[n._v("话不多说，直接上代码：")]),n._v(" "),t("p",[n._v("["),t("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),n._v("](<javascript:void(0);>)")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("/*\n * @Description: html 转为 pdf 并下载\n * @Author: cmyoung\n * @Date: 2018-08-10 19:07:32\n * @LastEditTime: 2019-08-23 16:34:18\n */\n\n/**\n * @param html { String } DOM树\n * @param isOne { Boolean }  是否为单页 默认 否(false)\n * @return 文件 {pdf格式}\n */\n\n'use strict'\nimport * as jsPDF from 'jspdf'\nimport html2canvas from 'html2canvas'\n\nexport default async (html, isOne) => {\n  let contentWidth = html.clientWidth // 获得该容器的宽\n  let contentHeight = html.clientHeight // 获得该容器的高\n  let canvas = document.createElement('canvas')\n  let scale = 2  // 解决清晰度问题，先放大 2倍\n\n  canvas.width = contentWidth * scale // 将画布宽&&高放大两倍\n  canvas.height = contentHeight * scale\n  canvas.getContext('2d').scale(scale, scale)\n\n  let opts = {\n    scale: scale,\n    canvas: canvas,\n    width: contentWidth,\n    height: contentHeight,\n    useCORS: true\n  }\n\n  return html2canvas(html, opts).then(canvas => {\n    let pageData = canvas.toDataURL('image/jpeg', 1.0) // 清晰度 0 - 1\n    let pdf\n\n    if (isOne) {\n      // 单页\n      console.log(contentWidth, 'contentWidth')\n      console.log(contentHeight, 'contentHeight')\n\n      // jspdf.js 插件对单页面的最大宽高限制 为 14400\n      let limit = 14400\n\n      if (contentHeight > limit) {\n        let contentScale = limit / contentHeight\n        contentHeight = limit\n        contentWidth = contentScale * contentWidth\n      }\n\n      let orientation = 'p'\n      // 在 jspdf 源码里，如果是 orientation = 'p' 且 width > height 时， 会把 width 和 height 值交换，\n      // 类似于 把 orientation 的值修改为 'l' , 反之亦同。\n      if (contentWidth > contentHeight) {\n        orientation = 'l'\n      }\n\n      // orientation Possible values are \"portrait\" or \"landscape\" (or shortcuts \"p\" or \"l\")\n      pdf = new jsPDF(orientation, 'pt', [contentWidth, contentHeight]) // 下载尺寸 a4 纸 比例\n\n      // pdf.addImage(pageData, 'JPEG', 左，上，宽度，高度)设置\n      pdf.addImage(pageData, 'JPEG', 0, 0, contentWidth, contentHeight)\n    } else {\n      //一页 pdf 显示 html 页面生成的 canvas高度\n      let pageHeight = (contentWidth / 552.28) * 841.89\n      //未生成 pdf 的 html页面高度\n      let leftHeight = contentHeight\n      //页面偏移\n      let position = 0\n      //a4纸的尺寸[595.28,841.89]，html 页面生成的 canvas 在pdf中图片的宽高\n      let imgWidth = 555.28\n      let imgHeight = (imgWidth / contentWidth) * contentHeight\n\n      pdf = new jsPDF('', 'pt', 'a4') // 下载尺寸 a4 纸 比例\n      //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)\n      //当内容未超过pdf一页显示的范围，无需分页\n      if (leftHeight < pageHeight) {\n        pdf.addImage(pageData, 'JPEG', 20, 0, imgWidth, imgHeight)\n      } else {\n        while (leftHeight > 0) {\n          pdf.addImage(pageData, 'JPEG', 20, position, imgWidth, imgHeight)\n          leftHeight -= pageHeight\n          position -= 841.89\n          //避免添加空白页\n          if (leftHeight > 0) {\n            pdf.addPage()\n          }\n        }\n      }\n    }\n    return pdf\n  })\n}\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br"),t("span",{staticClass:"line-number"},[n._v("50")]),t("br"),t("span",{staticClass:"line-number"},[n._v("51")]),t("br"),t("span",{staticClass:"line-number"},[n._v("52")]),t("br"),t("span",{staticClass:"line-number"},[n._v("53")]),t("br"),t("span",{staticClass:"line-number"},[n._v("54")]),t("br"),t("span",{staticClass:"line-number"},[n._v("55")]),t("br"),t("span",{staticClass:"line-number"},[n._v("56")]),t("br"),t("span",{staticClass:"line-number"},[n._v("57")]),t("br"),t("span",{staticClass:"line-number"},[n._v("58")]),t("br"),t("span",{staticClass:"line-number"},[n._v("59")]),t("br"),t("span",{staticClass:"line-number"},[n._v("60")]),t("br"),t("span",{staticClass:"line-number"},[n._v("61")]),t("br"),t("span",{staticClass:"line-number"},[n._v("62")]),t("br"),t("span",{staticClass:"line-number"},[n._v("63")]),t("br"),t("span",{staticClass:"line-number"},[n._v("64")]),t("br"),t("span",{staticClass:"line-number"},[n._v("65")]),t("br"),t("span",{staticClass:"line-number"},[n._v("66")]),t("br"),t("span",{staticClass:"line-number"},[n._v("67")]),t("br"),t("span",{staticClass:"line-number"},[n._v("68")]),t("br"),t("span",{staticClass:"line-number"},[n._v("69")]),t("br"),t("span",{staticClass:"line-number"},[n._v("70")]),t("br"),t("span",{staticClass:"line-number"},[n._v("71")]),t("br"),t("span",{staticClass:"line-number"},[n._v("72")]),t("br"),t("span",{staticClass:"line-number"},[n._v("73")]),t("br"),t("span",{staticClass:"line-number"},[n._v("74")]),t("br"),t("span",{staticClass:"line-number"},[n._v("75")]),t("br"),t("span",{staticClass:"line-number"},[n._v("76")]),t("br"),t("span",{staticClass:"line-number"},[n._v("77")]),t("br"),t("span",{staticClass:"line-number"},[n._v("78")]),t("br"),t("span",{staticClass:"line-number"},[n._v("79")]),t("br"),t("span",{staticClass:"line-number"},[n._v("80")]),t("br"),t("span",{staticClass:"line-number"},[n._v("81")]),t("br"),t("span",{staticClass:"line-number"},[n._v("82")]),t("br"),t("span",{staticClass:"line-number"},[n._v("83")]),t("br"),t("span",{staticClass:"line-number"},[n._v("84")]),t("br"),t("span",{staticClass:"line-number"},[n._v("85")]),t("br"),t("span",{staticClass:"line-number"},[n._v("86")]),t("br"),t("span",{staticClass:"line-number"},[n._v("87")]),t("br"),t("span",{staticClass:"line-number"},[n._v("88")]),t("br"),t("span",{staticClass:"line-number"},[n._v("89")]),t("br"),t("span",{staticClass:"line-number"},[n._v("90")]),t("br"),t("span",{staticClass:"line-number"},[n._v("91")]),t("br"),t("span",{staticClass:"line-number"},[n._v("92")]),t("br"),t("span",{staticClass:"line-number"},[n._v("93")]),t("br"),t("span",{staticClass:"line-number"},[n._v("94")]),t("br"),t("span",{staticClass:"line-number"},[n._v("95")]),t("br"),t("span",{staticClass:"line-number"},[n._v("96")]),t("br")])]),t("p",[n._v("["),t("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),n._v("](<javascript:void(0);>)")]),n._v(" "),t("p",[n._v("以上方法支持，生成的 pdf 为 单页或多页可选，如果不是需求必须是多页的，建议都选择生成 单页的，为什么呢？")]),n._v(" "),t("p",[n._v("因为单页不会出现内容或文字分割的情况。")]),n._v(" "),t("p",[n._v("但是，如果内容过长超过 14400 的话，那么你会发现 14400 之外的内容获取不到了，这是为什么呢？看来 jspdf 的源码之后找到答案，源码里面有限制：")]),n._v(" "),t("p",[t("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1057407/201909/1057407-20190929204322414-1180600295.png",alt:"img"}})]),n._v(" "),t("p",[n._v("不过，我的代码里已经解决过长的问题（宽度一般不会超过，特殊场景暂不考虑），超过 14400 时，按照高度就为 14400 来算缩放比例，宽度按比例缩放好像就行了，这就完事了？")]),n._v(" "),t("p",[n._v("不不不，好像还有坑，就是 orientation ，有两个值 \"portrait\" or \"landscape\"，默认是 'p', 当 orientation = 'p' 且 width > height 时， 他默认会把 width 和 height 值交换，如果你不想要他交换，那么当你的 width > height 时，你把 orientation 动态改为 'l' 即可，反之亦然。")]),n._v(" "),t("p",[t("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1057407/201909/1057407-20190929205457859-1507713517.png",alt:"img"}})]),n._v(" "),t("p",[n._v("以上希望对你有用，谢谢！")])])}),[],!1,null,null,null);s.default=e.exports}}]);